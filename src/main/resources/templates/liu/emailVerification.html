<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<style>
		body {
			height: 100vh;
			width: 100%;
			background-color: black;
			background-size: cover;
			background-image: linear-gradient(to right, rgb(0, 0, 0), rgba(102, 102, 102, 0.589)), url("../img/test1.jpg");
		}
	</style>
	<title>Carbon</title>
</head>

<body>
	<div th:replace="${session.memberBeans} ? ~{layout/navHomeLogin} : ~{layout/navHome} "></div>
	<div class="container h-100">
		<div class="row h-100">
			<div class="col-12 my-auto">
				<h1 id="status">[[${status}]]</h1>
				<div class="d-flex justify-content-start align-items-center d-none" id="verification">
					<button class="btn btn-primary fs-2 me-2" id="verifyBtn">傳送驗證網址</button>
					<span class="text-light fs-2 d-none" id="alreadySend">驗證網址已發送</span>

				</div>
				<div class="text-light fs-5 m-2" id="restore"></div>
			</div>
		</div>
	</div>
	<script>
		const status = document.querySelector("#status").innerText;
		console.log(status);
		const verification = document.querySelector("#verification");
		const alreadySend = document.querySelector("#alreadySend");
		const restore = document.querySelector("#restore");
		if (status == '驗證網址過期，請重新取得驗證網址') {
			verification.classList.remove('d-none');
		}
		const verifyBtn = document.querySelector("#verifyBtn");
		verifyBtn.addEventListener('click', function () {
			let currentURL = window.location.href;
			let urlParams = new URLSearchParams(currentURL);
			let memberId = urlParams.get('userId');
			getUrlAgain(memberId);
			verifyBtn.setAttribute('disabled', true);
			restoreBtn()
			alreadySend.classList.remove('d-none');

		})

		function restoreBtn() {

			let second = 30;
			let interval1 = setInterval(function () {
				if (second == 0) {
					console.log(second);
					restore.innerText = '';
					alreadySend.classList.add('d-none');
					verifyBtn.removeAttribute('disabled');
					clearInterval(interval1);
				} else {
					restore.innerText = `${second} 秒後即可重新傳送`;
					second = second - 1;
				}
			}, 1000)
		}


		function getUrlAgain(memberId) {
			axios({
				url: "http://localhost:8080/carbon/main/api/getEmail",
				method: "get",
				params: {
					'id': parseInt(memberId)
				},
				headers: { 'Content-Type': 'application/x-www-form-urlencode' }
			})
				.then(response => {
					console.log(response.data);
				})
		}
	</script>
</body>

</html>